# Значения по умолчанию

## Введение

Значение по умолчанию — это начальное значение поля в состоянии создания. Вы можете задать значение по умолчанию при настройке поля в таблице данных или указать значение по умолчанию для поля в блоке формы добавления. Оно может быть установлено как константа или переменная.

## Где можно настроить значения по умолчанию?

### Поля таблицы данных

![20240411095933](https://static-docs.nocobase.com/20240411095933.png)

### Поля формы добавления

Большинство полей формы добавления поддерживают установку значений по умолчанию.

![20240411100030](https://static-docs.nocobase.com/20240411100030.png)

### Добавление в подформу

Независимо от того, добавляете ли вы или редактируете данные в подформе, новые данные будут иметь значения по умолчанию.

Добавление новых данных в подформу (Add new):

![20240411100341](https://static-docs.nocobase.com/20240411100341.png)

Добавление новых данных в подтаблицу (Add new):

![20240411100424](https://static-docs.nocobase.com/20240411100424.png)

![20240411100634](https://static-docs.nocobase.com/20240411100634.png)

При редактировании существующих данных пустые поля не будут заполняться значениями по умолчанию. Значения по умолчанию применяются только к новым данным до их сохранения.

![20240411100729](https://static-docs.nocobase.com/20240411100729.png)

### Значения по умолчанию для связанных данных

Значения по умолчанию доступны только для отношений типа «многие-к-одному» и «многие-ко-многим», если используются компоненты выбора (Select, RecordPicker).

![20240411101025](https://static-docs.nocobase.com/20240411101025.png)

## Переменные значений по умолчанию

### Какие переменные доступны?

- Переменные даты;
- Текущий пользователь;
- Текущая запись (доступна только для уже существующих данных);
- Текущая форма (в идеале перечисляются только поля формы);
- Текущий объект (концепция строки данных в подформе);
- Выбранная запись в форме (в настоящее время применимо только для комбинации «Таблица + Форма добавления записи»).

Более подробная информация о переменных доступна в разделе [Переменные](/handbook/ui/variables).

### Переменные значений по умолчанию для полей

Подразделяются на два типа: поля без отношений и поля с отношениями.

#### Переменные значений по умолчанию для полей с отношениями

- Объект переменной должен быть записью коллекции (collection);
- Таблица должна находиться на пути наследования, это может быть текущая таблица или родительская/дочерняя таблица;
- Переменная «Выбранная запись в форме» доступна только для полей отношений типа «многие-ко-многим» и «один-ко-многим/многие-к-одному»;
- **При наличии нескольких уровней необходимо выполнить "уплощение" данных и удаление дубликатов.**

```typescript
// Выбранные записи в таблице:
[{id:1},{id:2},{id:3},{id:4}]

// Выбранные записи в таблице/отношение «один-ко-многим»:
[{toOne: {id:2}}, {toOne: {id:3}}, {toOne: {id:3}}] 
// Уплощение и удаление дубликатов
[{id: 2}, {id: 3}]

// Выбранные записи в таблице/отношение «многие-ко-многим»:
[{toMany: [{id: 1}, {id:2}]}, {toMany: [{id:3}, {id:4}]}]
// Уплощение  
[{id:1},{id:2},{id:3},{id:4}]
```
#### Переменные значений по умолчанию для несвязанных полей

- Типы должны быть совместимыми, например, строки совместимы с числами и со всеми объектами, предоставляющими метод `toString`.
- Поле JSON является особым случаем, так как может хранить любые данные.

### Уровни полей (дополнительные поля)

![20240411101157](https://static-docs.nocobase.com/20240411101157.png)

- **Переменные значений по умолчанию для несвязанных полей**:
  - При выборе многоуровневых полей поддерживаются только отношения «один-ко-многим», но не «многие-ко-многим».
  - Поле JSON — особый случай, ограничения отсутствуют.

- **Переменные значений по умолчанию для связанных полей**:
  - `hasOne` поддерживает только отношение «один-к-одному».
  - `hasMany` поддерживает как отношение «один-ко-многим» (внутренняя конвертация), так и «многие-ко-многим».
  - `belongsToMany` поддерживает как отношение «один-ко-многим» (внутренняя конвертация), так и «многие-ко-многим».
  - `belongsTo` обычно используется для отношений «один-ко-многим», но если родительское отношение — `hasMany`, то также поддерживается «многие-ко-многим» (поскольку `hasMany/belongsTo` фактически является отношением «многие-ко-многим»).

## Особые случаи

### Эквивалентность «многие-ко-многим» и комбинации «один-ко-многим/многие-к-одному»

Модель:

![20240411101558](https://static-docs.nocobase.com/20240411101558.png)

При настройке переменных значений по умолчанию для «многие-ко-многим», если переменная содержит несколько записей, то выбранные данные будут включать несколько записей, как показано ниже. Это применимо, когда таблица данных блока таблицы совпадает с таблицей данных поля отношений.

![20240411103021](https://static-docs.nocobase.com/20240411103021.png)

### Почему у «один-к-одному» и «один-ко-многим» нет значений по умолчанию?

Например, в отношении A.B, если b1 связано с a1, оно не может быть связано с a2. Если b1 свяжется с a2, связь с a1 будет разорвана. В этом случае данные не являются общими, а значения по умолчанию основаны на механизме общего доступа (любая связь возможна). Поэтому для «один-к-одному» и «один-ко-многим» нельзя настроить значения по умолчанию.

### Почему у «многие-к-одному» и «многие-ко-многим» в подформах или подтаблицах тоже нет значений по умолчанию?

Подформы и подтаблицы фокусируются на прямом редактировании связанных данных (включая добавление и удаление). Значения по умолчанию для связей основаны на механизме общего доступа (любая связь возможна), но не позволяют изменять связанные данные. Поэтому в таких случаях значения по умолчанию не подходят.

Кроме того, подформы и подтаблицы содержат дочерние поля, и было бы неясно, относится ли значение по умолчанию к строке или к столбцу.

В итоге, независимо от типа связи, подформам и подтаблицам не следует напрямую назначать значения по умолчанию.