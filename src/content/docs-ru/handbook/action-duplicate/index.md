# Копирование

<PluginInfo name="action-duplicate"></PluginInfo>

## Введение

Операция копирования позволяет пользователям создавать новые записи данных на основе уже существующих. Поддерживаются два режима копирования: прямое копирование и копирование в форму для дальнейшего редактирования.

## Установка

Встроенный плагин, не требует отдельной установки.

## Режимы копирования

### Прямое копирование

![](https://static-docs.nocobase.com/2c0ac5d1a539de4b72b49b7d966d8c09.png)

- По умолчанию данные копируются напрямую.
- Целевая таблица данных: таблица, в которую будут добавлены скопированные данные (в случае наследования можно копировать в дочернюю таблицу; при прямом копировании данные добавляются только в текущую таблицу).
- Поля шаблона: используются для указания полей, которые нужно скопировать; можно выбрать все поля (обязательно для заполнения).

После завершения настройки нажмите кнопку, чтобы скопировать данные.

### Копирование в форму для дальнейшего редактирования

Настроенные поля шаблона будут использованы как значения по умолчанию, предварительно заполняя форму. После внесения изменений можно отправить форму для завершения операции копирования.

Можно настроить текущую таблицу или дочернюю таблицу как целевую таблицу для добавления скопированных данных (в сценарии наследования).

![](https://static-docs.nocobase.com/a072aa572fd0a0fe643eadf95471da2a.png)

Настройка полей шаблона: поля шаблона будут использованы как значения по умолчанию в форме и будут содержать только выбранные значения полей.

![](https://static-docs.nocobase.com/8032fa2025180ade275da55b97774b4d.png)

«Накладная» (o2m) — это отношение копирования. Настройте компоненты полей формы как подформу и настройте поля в подформе.

![](https://static-docs.nocobase.com/b13c9287bae8601646727a2e78b81be7.png)

#### Синхронизация полей формы

- Автоматически анализирует и добавляет в качестве полей шаблона поля, уже настроенные в текущем блоке формы;
- Если поля формы были изменены (например, изменен компонент связанного поля), можно снова открыть настройки шаблона и нажать кнопку синхронизации формы, чтобы обеспечить согласованность между формой и шаблоном;

![](https://static-docs.nocobase.com/156b6d8d741521e63d12e49092414d58.png)

Данные шаблона будут использованы как значения по умолчанию для заполнения формы. Данные можно изменить, а затем отправить для завершения копирования.

![](https://static-docs.nocobase.com/1c0a0ae0c59971f48b2282a68831d44b.png)

На изображении ниже показан полный пример настройки операции копирования для списка заказов.

![](https://static-docs.nocobase.com/fa8a89abf0ba136df04b6d0d838eae4e.gif)

### Дополнительные пояснения

#### Пояснения о копировании, ссылках и предварительной загрузке

Для различных полей (в зависимости от типа связи) применяется различная логика обработки (копирование, ссылка, предварительная загрузка). Изменение компонента поля также влияет на логику обработки (Select и Record Picker используются для обработки ссылочных отношений, Sub-form и Sub-table — для обработки копирования):

- **Копирование**
  - Обычные поля копируются;
  - Для полей связи типов hasOne и hasMany поддерживается только копирование (т.е. такие поля не могут использовать Select или Record Picker в качестве компонента поля; следует использовать Sub-form или Sub-table);
    - Изменение компонента полей hasOne и hasMany не влияет на логику обработки (копирование);
    - Для полей связи, которые копируются, доступны все дочерние поля;

- **Ссылка**

- **belongsTo** и **belongsToMany** являются ссылками;
  - **Ссылка может превратиться в копирование. Например, если компонент поля изменяется с Select на Sub-form, отношение из ссылки становится копированием (после перехода в режим копирования все дочерние поля становятся доступными для выбора).**

- **Предварительная загрузка**: поля связи внутри ссылочных полей.
  - Поля связи под полем связи являются предварительно загружаемыми;
  - Предварительно загруженные поля связи могут стать либо ссылкой, либо копированием после изменения компонента поля.

#### Выбор всех полей
- Все поля копирования и ссылочные поля автоматически отмечаются.

#### Записи, выбранные как шаблон данных, игнорируют значения следующих полей:
- Если данные связи копируются, то первичный ключ фильтруется; для ссылок и предварительной загрузки первичный ключ не фильтруется.
- Внешние ключи.
- Поля, которые не допускают дублирования.
- Поля сортировки.
- Поля с автоматическим кодированием.
- Пароли.
- Создано пользователем.
- Дата создания.
- Последнее обновление пользователем.
- Дата последнего обновления.

#### Синхронизация полей формы
- Автоматически анализирует и добавляет в качестве полей шаблона поля, уже настроенные в текущем блоке формы;
- Если поля формы были изменены (например, изменен компонент связанного поля), необходимо снова открыть настройки шаблона и нажать кнопку синхронизации формы, чтобы обеспечить согласованность между формой и шаблоном.