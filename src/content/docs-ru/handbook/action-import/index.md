# Импорт данных

<PluginInfo name="action-import"></PluginInfo>

## Введение

## Установка

## Инструкции по импорту

### Числовые типы полей

Поддерживаются числа и проценты, текст `N/A` или `-` будет отфильтрован.

| Число1 | Процент | Число2 | Число3 |
| ------ | ------- | ------ | ------ |
| 123    | 25%     | N/A    | -      |

После преобразования в JSON:

```ts
{
  "Число1": 123,
  "Процент": 0.25,
  "Число2": null,
  "Число3": null,
}
```

### Логические типы полей

Поддерживаемый текст для ввода (английский без учета регистра):

- `Yes` `Y` `True` `1` `Да`
- `No` `N` `False` `0` `Нет`

| Поле1 | Поле2 | Поле3 | Поле4 | Поле4 |
| ----- | ----- | ----- | ----- | ----- |
| Нет   | Да    | Y     | true  | 0     |

После преобразования в JSON:

Прошу прощения за недоразумение. Вот перевод предоставленного текста на русский язык без каких-либо изменений или дополнений:

---

```ts
{
  "Поле1": false,
  "Поле2": true,
  "Поле3": true,
  "Поле4": true,
  "Поле5": false,
}
```

### Поле типа дата

| DateOnly            | Local(+08:00)       | GMT                 |
| ------------------- | ------------------- | ------------------- |
| 2023-01-18 22:22:22 | 2023-01-18 22:22:22 | 2023-01-18 22:22:22 |

После преобразования в JSON:

```ts
{
  "DateOnly": "2023-01-18T00:00:00.000Z",
  "Local(+08:00)": "2023-01-18T14:22:22.000Z",
  "GMT": "2023-01-18T22:22:22.000Z",
}
```

### Поле типа выбор

Значения опций и метки опций могут использоваться как текст для импорта, множественные опции разделяются запятой (`,` `，`) или тире (`、`).

Например, поле `Приоритет` имеет следующие доступные опции:

| Значение опции | Метка опции |
| -------------- | ----------- |
| low            | Низкий      |
| medium         | Средний     |
| high           | Высокий     |

Значения опций и метки опций могут использоваться как текст для импорта.

| Приоритет |
| --------- |
| Высокий   |
| low       |

После преобразования в JSON:


```ts
[{ "Приоритет": "high" }, { "Приоритет": "low" }];
```

### Поле административного деления Китая

| Регион1         | Регион2         |
| --------------- | --------------- |
| Пекин/городской район | Тяньцзинь/городской район |

После преобразования в JSON:

```ts
{
  "Регион1": ["11","1101"],
  "Регион2": ["12","1201"]
}
```

### Поле вложения

| Вложение                                     |
| -------------------------------------------- |
| https://www.nocobase.com/images/logo.png |

После преобразования в JSON:

```ts
{
  "附件": [
    {
      "filename": "logo.png",
      "title": "logo.png",
      "extname": ".png",
      "url": "https://www.nocobase.com/images/logo.png"
    }
  ]
}
```

### Поле типа "Связь"

Несколько записей разделяются запятыми (`,` `，`) или тонкими паузами (`、`).

| Отдел/Название | Категория/Заголовок    |
| -------------- | ---------------------- |
| Группа разработки | Категория1, Категория2 |

После преобразования в JSON:

```ts
{
  "Отдел": [1], // 1 - это ID записи, где название отдела "开发组" (Группа разработки)
  "Категория": [1, 2] // 1, 2 - это ID записей, где названия категорий "分类1" и "分类2" (Категория1 и Категория2)
}
```

### Поле типа JSON

| JSON1           |
| --------------- |
| {"key":"value"} |

После преобразования в JSON:

```ts
{
  "JSON": {"key":"value"}
}
```

### Тип геометрии карты

| Point | Line        | Polygon           | Circle |
| ----- | ----------- | ----------------- | ------ |
| 1,2   | (1,2),(3,4) | (1,2),(3,4),(1,2) | 1,2,3  |

После преобразования в JSON:

```ts
{
  "Point": [1,2],
  "Line": [[1,2], [3,4]],
  "Polygon": [[1,2], [3,4], [1,2]],
  "Circle": [1,2,3]
}
```

## Пользовательский формат импорта

Зарегистрируйте пользовательский `ValueParser` с помощью метода `db.registerFieldValueParsers()`, например:

```ts
import { BaseValueParser } from '@nocobase/database';

class PointValueParser extends BaseValueParser {
  async setValue(value) {
    if (Array.isArray(value)) {
      this.value = value;
    } else if (typeof value === 'string') {
      this.value = value.split(',');
    } else {
      this.errors.push('Value invalid');
    }
  }
}

const db = new Database();

// При импорте поля type=point данные будут анализироваться с помощью PointValueParser.
db.registerFieldValueParsers({
  point: PointValueParser,
});
```

导入示例

| Point |
| ----- |
| 1,2   |

转 JSON 之后为

```ts
{
  "Point": [1,2]
}
```
