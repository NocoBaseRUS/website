# Аутентификация: OIDC

## Введение

Плагин "Аутентификация: OIDC" соответствует стандарту протокола OIDC (Open ConnectID) и использует поток авторизационного кода (Authorization Code Flow), позволяя пользователям входить в NocoBase с использованием учетных данных, предоставленных сторонним поставщиком услуг аутентификации (IdP).

## Активация плагина

![](https://static-docs.nocobase.com/a494476c352a949a276d64e96e6ac587.png)

## Добавление аутентификации OIDC

Перейдите на страницу управления плагином аутентификации пользователей.

![](https://static-docs.nocobase.com/4e598e7df963d7d23188afe3576456d6.png)

Добавьте - OIDC

![](https://static-docs.nocobase.com/1efbde1c0e2f4967efc1c4336be45ca2.png)

## Настройка

### Базовая конфигурация

![](https://static-docs.nocobase.com/d80715319639e1681a28a97ad3131f21.png)

- Sign up automatically when the user does not exist — Автоматическое создание нового пользователя, если не удается найти существующего для привязки.
- Issuer — Издатель (issuer) предоставляется IdP и обычно заканчивается на `/.well-known/openid-configuration`.
- Client ID — Идентификатор клиента.
- Client Secret — Секретный ключ клиента.
- scope — Необязательно. По умолчанию: `openid email profile`.
- id_token signed response algorithm — Метод подписи для id_token. По умолчанию: `RS256`.

### Сопоставление полей

![](https://static-docs.nocobase.com/92d63c8f6f4082b50d9f475674cb5650.png)

- Field Map — Сопоставление полей. В настоящее время доступные для сопоставления поля на стороне NocoBase включают псевдоним, электронную почту и номер телефона. По умолчанию псевдоним использует значение `openid`.
- Use this field to bind the user — Поле, используемое для сопоставления и привязки к существующему пользователю. Можно выбрать электронную почту или имя пользователя. По умолчанию используется электронная почта. Требуется, чтобы информация о пользователе, предоставляемая IdP, содержала поле `email` или `username`.

### Расширенная конфигурация

![](https://static-docs.nocobase.com/d9e8040118e8e2ecdc3c847f72bbb5a9.png)

- HTTP — Определяет, используется ли протокол HTTP для обратного вызова NocoBase. По умолчанию: `https`.
- Port — Порт для адреса обратного вызова NocoBase. По умолчанию: `443/80`.
- State token — Используется для проверки источника запроса и предотвращения атак CSRF. Можно указать фиксированное значение, но настоятельно рекомендуется оставить поле пустым, чтобы по умолчанию генерировалось случайное значение. Если вы хотите использовать фиксированное значение, пожалуйста, самостоятельно оцените вашу среду использования и связанные с этим риски безопасности.
- Pass parameters in the authorization code grant exchange — При обмене кода на токен некоторые IdP могут требовать передачу Client ID или Client Secret в качестве параметров. Можно выбрать и заполнить соответствующие имена параметров.
- Method to call the user info endpoint — HTTP-метод для запроса получения информации о пользователе через API.
- Where to put the access token when calling the user info endpoint — Способ передачи access token при запросе информации о пользователе через API:
  - Header — Заголовок запроса (по умолчанию).
  - Body — Тело запроса, используется вместе с методом `POST`.
  - Query parameters — Параметры запроса, используется вместе с методом `GET`.

### Использование

![](https://static-docs.nocobase.com/2edbea211232cea6d38c79630132418c.png)

- **Использование (Usage)** — URL обратного вызова (Redirect URL) используется для копирования и заполнения в соответствующей конфигурации IdP.

:::info
При локальном тестировании используйте `127.0.0.1` вместо `localhost`, так как метод аутентификации OIDC требует записи состояния (state) в cookie клиента для проверки безопасности. Если во время входа окно быстро исчезает, но вход не завершается, проверьте, есть ли в логах сервера сообщения о несоответствии state, а также содержит ли cookie запроса параметр state. Обычно это происходит из-за несоответствия state в cookie клиента и state, переданного в запросе.
:::

## Вход

Перейдите на страницу входа и нажмите кнопку под формой входа для инициирования входа через сторонний сервис.

![](https://static-docs.nocobase.com/e493d156254c2ac0b6f6e1002e6a2e6b.png)
