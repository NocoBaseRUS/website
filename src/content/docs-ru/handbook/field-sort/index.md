# Поле сортировки

<PluginInfo name="field-sort"></PluginInfo>

## Введение

Поле сортировки используется для упорядочивания записей в таблице данных. Оно поддерживает сортировку с предварительной группировкой (sort1).

:::warning
Поскольку поле сортировки является полем той же таблицы, при групповой сортировке одна и та же запись не может быть отнесена к нескольким группам.
:::

## Установка

Встроенный плагин, не требует отдельной установки.

## Руководство пользователя

### Создание поля сортировки

![20240409091123_rec_](https://static-docs.nocobase.com/20240409091123_rec_.gif)

При создании поля сортировки значения сортировки будут инициализированы следующим образом:

- Если групповая сортировка не выбрана, инициализация будет основана на поле первичного ключа и поле даты создания.
- Если выбрана групповая сортировка, данные сначала будут сгруппированы, а затем инициализированы на основе поля первичного ключа и поля даты создания.

:::warning{title="Примечание о согласованности транзакций"}
- Если при создании поля инициализация значений сортировки завершится неудачно, поле сортировки создано не будет.
- При перемещении записи из позиции A в позицию B в определенном диапазоне все значения сортировки записей в интервале AB будут изменены. Если изменение хотя бы одной записи завершится неудачно, перемещение не будет выполнено, и значения сортировки связанных записей останутся без изменений.
:::

#### Пример 1: Создание поля sort1

Поле sort1 без группировки:

![20240409091510](https://static-docs.nocobase.com/20240409091510.png)

Значения полей сортировки каждой записи будут инициализированы на основе поля первичного ключа и поля даты создания:

![20240409092305](https://static-docs.nocobase.com/20240409092305.png)

#### Пример 2: Создание поля sort2 с группировкой по ID класса

![20240409092620](https://static-docs.nocobase.com/20240409092620.png)

На этом этапе все записи в таблице данных сначала группируются (по ID класса), а затем происходит инициализация поля сортировки (sort2). Значения инициализации для каждой записи:

![20240409092847](https://static-docs.nocobase.com/20240409092847.png)

### Перетаскивание для сортировки

Поле сортировки в основном используется для перетаскивания записей в различных блоках. В настоящее время поддерживаются блоки "Таблица" и "Канбан".

:::warning
- Использование одного и того же поля сортировки для перетаскивания в разных блоках может нарушить существующую сортировку;
- Поле сортировки для перетаскивания строк в таблице не может быть полем сортировки с правилами группировки;
  - Исключение: в блоке таблицы отношений "один-ко-многим" внешний ключ может использоваться как группа.
- В настоящее время только блок "Канбан" поддерживает перетаскивание с группировкой.
:::

#### Перетаскивание строк в таблице

Блок таблицы:

![20240409104621_rec_](https://static-docs.nocobase.com/20240409104621_rec_.gif)

Блок таблицы отношений:

<video controls width="100%" src="https://static-docs.nocobase.com/20240409111903_rec_.mp4" title="Title"></video>

:::warning
В блоке отношений "один-ко-многим":

- Если выбрано поле сортировки без группировки, то в сортировке могут участвовать все записи;
- Если сначала происходит группировка по внешнему ключу, а затем сортировка, то правило сортировки будет влиять только на данные внутри текущей группы.

Итоговый результат одинаков, но количество записей, участвующих в сортировке, разное. Подробнее см. [Правила сортировки](#правила-сортировки).
:::

#### Перетаскивание карточек канбан

![20240409110423_rec_](https://static-docs.nocobase.com/20240409110423_rec_.gif)

### Пояснение к правилам сортировки

#### Перемещение между элементами без группировки (или в одной группе)

Предположим, у нас есть набор данных:

```
[1,2,3,4,5,6,7,8,9]
```

Когда один из элементов, например 5, перемещается вперед на позицию 3, изменяются только порядковые номера элементов 3, 4 и 5. Элемент 5 занимает позицию 3, а элементы 3 и 4 сдвигаются на одну позицию назад.

```
[1,2,5,3,4,6,7,8,9]
```

Если затем элемент 6 перемещается назад на позицию 8, то элемент 6 занимает место элемента 8, а элементы 7 и 8 сдвигаются на одну позицию вперед.

```
[1,2,5,3,4,7,8,6,9]
```

#### Перемещение элементов между разными группами

При сортировке с группировкой, когда запись перемещается в другую группу, группа, к которой она принадлежит, также меняется. Например, в следующем примере:

```
A: [1,2,3,4]
B: [5,6,7,8]
```

Когда элемент 1 перемещается к элементу 6 (по умолчанию размещается после него), группа, к которой принадлежит элемент 1, изменяется с A на B:

```
A: [2,3,4]
B: [5,6,1,7,8]
```

#### Изменение порядка сортировки не зависит от данных, отображаемых на интерфейсе

Например, имеется набор данных:

```
[1,2,3,4,5,6,7,8,9]
```

На интерфейсе отображаются только следующие элементы:

```
[1,5,9]
```

Когда элемент 1 перемещается на позицию элемента 9, позиции всех промежуточных элементов (2, 3, 4, 5, 6, 7, 8) также изменяются:

```
[2,3,4,5,6,7,8,9,1]
```

Интерфейс отображает:

```
[5,9,1]
```