# Панель конфигурации

Панель конфигурации диаграммы в целом разделена на три части: настройка данных, настройка диаграммы и предварительный просмотр диаграммы.

<img src="https://static-docs.nocobase.com/202404192019222.png"/>

## Настройка данных

<img src="https://static-docs.nocobase.com/202404192020544.png"/>

- Выпадающее меню в верхней части отображает текущую настраиваемую таблицу (Collection), которую можно переключить через выпадающий список.
- После завершения настройки нажмите «Выполнить запрос» (Run query), чтобы получить данные по конфигурации. Данные будут показаны в панели «Данные» (Data).

### Измерения (Measures)

<img src="https://static-docs.nocobase.com/202404192023854.png"/>

Измерения — это обычно основные данные, которые необходимо отобразить на диаграмме. Измерения могут быть статистически обработаны с помощью агрегатных функций, поддерживаются общие статистические функции базы данных: `Сумма (Sum)`, `Количество (Count)`, `Среднее значение (Avg)`, `Максимум (Max)`, `Минимум (Min)`. Полей измерений может быть несколько, для них можно задавать псевдонимы.

### Размерности (Dimensions)

<img src="https://static-docs.nocobase.com/202404192025717.png"/>

Размерностные поля обычно используются для группировки данных диаграммы. Для полей типа «дата» поддерживаются способы форматирования, как показано на рисунке. Форматирование выполняется через функции базы данных (например, для MySQL используется `date_format`). Информацию о форматировании других типов данных см. в разделе [Преобразование данных](#数据转换).

:::info
**Форматирование размерностей (Dimensions Format) VS Преобразование данных (Transformation)**

- Форматирование размерностей происходит до получения финальных данных, группировка данных осуществляется по отформатированным значениям размерностей. Обычно это требуется при фильтрации данных по временному периоду.
- Преобразование данных выполняет дополнительную обработку ответных данных, например, делая их более читаемыми. Преобразование данных выполняется на стороне клиента.
:::

### Фильтрация (Filter)

<img src="https://static-docs.nocobase.com/202404192029597.png"/>

Настройки фильтрации будут применяться к данным до группировки. Поддерживается использование переменных для динамического диапазона фильтрации в конфигурации диаграммы:

- Текущий пользователь: информация о текущем авторизованном пользователе.
- Переменные даты: диапазон дат, рассчитываемый динамически на основе текущей даты.
- Текущая фильтрация: настраиваемые поля фильтрации, сконфигурированные в блоке диаграммы. См. также: [Блок фильтрации](./filter.md).

### Сортировка (Sort) и ограничение (Limit)

<img src="https://static-docs.nocobase.com/202404192034106.png"/>

Максимальное количество записей в наборе данных по умолчанию — 2000.

### Кэширование

<img src="https://static-docs.nocobase.com/202404192035918.png"/>

После включения кэширования диаграмма будет отображать данные из кэша. Можно настроить время хранения кэшированных данных.

## Настройка диаграммы

### Настройка контейнера

Здесь можно настроить свойства компонента контейнера, в котором отображается диаграмма.

- Заголовок диаграммы
- Отображение рамки вокруг диаграммы

<img src="https://static-docs.nocobase.com/202404192037644.png"/>

Пример отображения заголовка диаграммы:

<img src="https://static-docs.nocobase.com/202404192048473.png"/>

Пример отображения рамки вокруг диаграммы:

<img src="https://static-docs.nocobase.com/202404192048223.png"/>

### Настройка диаграммы

<img src="https://static-docs.nocobase.com/202404192050696.png"/>

- Тип диаграммы (Chart Type) — тип диаграммы для отображения. NocoBase использует <a href="https://g2plot.antv.antgroup.com/" target="_blank">Ant Design Charts</a> 2.x как библиотеку диаграмм по умолчанию. Если вы хотите расширить использование другими библиотеками или компонентами диаграмм, обратитесь к [руководству по разработке](../dev/index.md).
- Базовая конфигурация — после выбора типа диаграммы появятся соответствующие базовые настройки визуализации, такие как поля оси X, поля оси Y, поля категорий и т.д. Для настройки полей обычно предоставляется выпадающее меню с вариантами, включая базовые поля коллекции и псевдонимы полей.
- Конфигурация JSON — если базовых настроек недостаточно, вы можете использовать документацию соответствующего компонента диаграммы, чтобы настроить дополнительные атрибуты через JSON. Если вы хотите использовать JavaScript-выражения в конфигурации JSON, заключите выражения в `{{}}`. Пример:

```json
{
  "label": {
    "type": "inner",
    "content": "{{ ({ percent }) => `${(percent * 100).toFixed(0)}%` }}"
  }
}
```

## Преобразование данных

<img src="https://static-docs.nocobase.com/202404192109597.png"/>

Использование преобразования данных позволяет дополнительно обработать данные, полученные от интерфейса. В настоящее время поддерживаются следующие типы данных для преобразования: `number`, `date`, `time`, `datetime`. Для полей, которые не относятся к поддерживаемым типам данных, можно вручную выбрать один из этих типов, чтобы использовать соответствующие методы преобразования.

К одному и тому же полю можно применить несколько методов преобразования. Программа выполнит их последовательно, передавая результат одного преобразования следующему. Порядок преобразований можно изменять с помощью перетаскивания.

:::warning
Следует учитывать, что некоторые методы преобразования могут изменить исходный тип данных. При применении нескольких методов преобразования необходимо выбирать правильные методы на основе типа данных после каждого преобразования. Например, при комбинировании точности и префикса для преобразования числа в денежный формат следует сначала применить преобразование точности, а затем добавить префикс. Это связано с тем, что число после добавления префикса становится строкой и больше не может быть использовано для преобразования точности.
:::

В настоящее время поддерживаются следующие методы преобразования:

| Тип                                  | Метод       | Описание                                                                                                                           | Тип после преобразования         |
| ------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------ |
| Число (`number`)                       | Префикс       |                                                                                                                                | `string`           |
|                                       | Суффикс       |                                                                                                                                | `string`           |
|                                       | Точность     | `1`, `1.0`, `1.00`, `1.000`                                                                                                    | `number`           |
|                                       | Разделитель     | `100,000.00`, `100.000,00`, `100 000.00`                                                                                       | `string`           |
|                                       | Процент     |                                                                                                                                | `string`           |
|                                       | Экспоненциальная запись |                                                                                                                                | `number`           |
|                                       | Сокращение       | `1K`, `1M`, `1 тыс.`, `1 млн.` и т.д.                                                                                                    | `string`           |
| Дата-время (`datetime`, `date`, `time`) | Форматирование     | Предустановленные форматы: `YYYY-MM-DD` и т.д., также можно задать собственный. См. <a href="https://day.js.org/docs/en/display/format" target="_blank">dayjs</a> | `string`           |
|                                       | Префикс       |                                                                                                                                | `string`           |
|                                       | Суффикс       |                                                                                                                                | `string`           |
| Строка (`string`)                     | Преобразование типа   | Преобразование в дату-время или число                                                                                                           | `Date` \| `number` |
|                                       | Префикс       |                                                                                                                                | `string`           |
|                                       | Суффикс       |                                                                                                                                | `string`           |