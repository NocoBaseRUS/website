# Пример

## Проверка статьи

Предположим, что статьи, отправленные обычными пользователями, должны быть проверены администратором и только после этого могут быть обновлены до статуса "опубликовано". Если запрос отклоняется, статья остается в состоянии черновика (не опубликована). Этот процесс может быть реализован с помощью обновления формы в ручном узле.

Создайте рабочий процесс, запускаемый при "создании новой статьи", и добавьте ручной узел:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Организация процесса" src="https://github.com/nocobase/nocobase/assets/525658/2021bf42-f372-4f69-9c84-5a786c061e0e" width="360" />
</figure>

В ручном узле настройте ответственного — администратора. В интерфейсе настройки добавьте блок, основанный на данных триггера, для отображения подробной информации о новой статье:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Блок деталей" src="https://github.com/nocobase/nocobase/assets/525658/c61d0aac-23cb-4387-b60e-ce3cc7bf1c24" width="680" />
</figure>

В интерфейсе настройки добавьте блок, основанный на форме обновления данных, выберите таблицу статей, чтобы позволить администратору решать, одобрить ли проверку. После успешной проверки соответствующая статья будет обновлена согласно последующим конфигурациям. После добавления формы по умолчанию появится кнопка "Продолжить процесс", которая может рассматриваться как подтверждение при нажатии. Также добавьте кнопку "Завершить процесс", которая будет использоваться в случае отказа:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Форма и действия" src="https://github.com/nocobase/nocobase/assets/525658/4baaf41e-3d81-4ee8-a038-29db05e0d99f" width="673" />
</figure>

Для продолжения процесса нам нужно обновить статус статьи. Здесь есть два способа настройки: либо напрямую отобразить поле статуса статьи в форме для выбора оператором, либо использовать другой подход, который больше подходит для ситуаций, требующих активного заполнения формы, таких как предоставление обратной связи:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Поля формы" src="https://github.com/nocobase/nocobase/assets/525658/82ea4e0e-25fc-4921-841e-e1a2782a87d1" width="668" />
</figure>

Чтобы упростить действия оператора, можно настроить присвоение значений формы на кнопке "Продолжить процесс". Добавьте поле "статус" со значением "опубликовано". Это означает, что после нажатия кнопки статья будет обновлена до статуса "опубликовано":

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Присвоение значений формы" src="https://github.com/nocobase/nocobase/assets/525658/0340bd9f-8323-4e4f-bc5a-8f81be3d6736" width="711" />
</figure>

Затем выберите условия фильтрации данных для обновления из меню конфигурации в правом верхнем углу блока формы. Здесь выберите таблицу "статьи", а условие фильтрации установите как "ID `равно` переменная триггера / данные триггера / ID":

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Условия формы" src="https://github.com/nocobase/nocobase/assets/525658/da004055-0262-49ae-88dd-3844f3c92e28" width="1020" />
</figure>

Наконец, можно изменить заголовки различных блоков, текст кнопок и подсказки для полей формы, чтобы сделать интерфейс более удобным:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Настройка узла_Финальная форма" src="https://github.com/nocobase/nocobase/assets/525658/21db5f6b-690b-49c1-8259-4f7b8874620d" width="678" />
</figure>

После закрытия панели конфигурации и нажатия кнопки "Отправить" для сохранения настроек узла, настройка рабочего процесса завершена. После активации этого рабочего процесса при создании новой статьи он будет автоматически запущен. Администратор сможет увидеть этот рабочий процесс в списке задач "Ожидающие". Нажав для просмотра, можно увидеть подробности задачи:

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Список задач" src="https://github.com/nocobase/nocobase/assets/525658/4e1748cd-6a07-4045-82e5-286826607826" width="1363" />
</figure>

<figure>
  <img alt="Ручной узел_Пример_Проверка статьи_Подробности задачи" src="https://github.com/nocobase/nocobase/assets/525658/65f01fb1-8cb0-45f8-ac21-ec8ab59be449" width="680" />
</figure>

Администратор может принять решение о публикации статьи на основе её деталей. Если статья одобрена, нажмите кнопку "Принять", и статья будет обновлена до статуса "опубликовано". Если отклонена, нажмите кнопку "Отклонить", и статья останется в состоянии черновика.

## Утверждение заявления на отпуск

Предположим, что сотрудники должны подавать заявление на отпуск, которое должно быть одобрено руководителем, чтобы вступить в силу. После этого данные об отпуске сотрудников будут обновлены. Независимо от того, одобрено заявление или отклонено, через узел HTTP-запроса будет вызван SMS-интерфейс для отправки соответствующих уведомлений сотруднику (см. раздел [HTTP-запрос](#_HTTP_请求)). Этот сценарий может быть реализован с помощью пользовательской формы в ручном узле.

Создайте рабочий процесс, запускаемый при "добавлении заявления на отпуск", и добавьте ручной узел. Как и в предыдущем примере проверки статьи, ответственным здесь является руководитель. В интерфейсе настройки добавьте блок на основе данных триггера для отображения подробной информации о заявлении на отпуск и блок на основе пользовательской формы для принятия решения о его утверждении. В пользовательскую форму добавьте поле "одобрено/отклонено" и поле "причина отказа":

<figure>
  <img alt="Ручной узел_Пример_Утверждение заявления на отпуск_Настройка узла" src="https://github.com/nocobase/nocobase/assets/525658/ef3bc7b8-56e8-4a4e-826e-ffd0b547d1b6" width="675" />
</figure>

В отличие от процесса проверки статьи, поскольку нам нужно продолжить последующие шаги на основе решения руководителя, здесь мы настраиваем только одну кнопку "Продолжить процесс" для отправки, без использования кнопки "Завершить процесс".

Одновременно после ручного узла мы можем использовать узел условного оператора, чтобы определить, было ли заявление на отпуск одобрено руководителем. В ветке "одобрено" добавьте обработку данных обновления отпуска и после завершения ветки добавьте узел запроса для отправки SMS-уведомления сотруднику. Таким образом, получается следующий полный процесс:

<figure>
  <img alt="Ручной узел_Пример_Утверждение заявления на отпуск_Организация процесса" src="https://github.com/nocobase/nocobase/assets/525658/733f68da-e44f-4172-9772-a287ac2724f2" width="593" />
</figure>

Условие в узле условного оператора настраивается как "значение поля 'одобрено' в пользовательской форме ручного узла равно 'одобрено'":

<figure>
  <img alt="Ручной узел_Пример_Утверждение заявления на отпуск_Условный оператор" src="https://github.com/nocobase/nocobase/assets/525658/57b972f0-a3ce-4f33-8d40-4272ad205c20" width="678" />
</figure>

Данные в узле отправки запроса также могут использовать соответствующие переменные формы из ручного узла, чтобы различать содержание SMS для случаев одобрения и отказа. Таким образом, настройка всего процесса завершена. После активации рабочего процесса, когда сотрудник отправляет форму заявления на отпуск, руководитель сможет обработать её в списке задач "Ожидающие". Операции аналогичны процессу проверки статьи.
