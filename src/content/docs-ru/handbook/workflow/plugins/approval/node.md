# Узел утверждения

В рабочем процессе утверждения необходимо использовать специализированный узел "Утверждение" для настройки логики операций, предназначенной для обработки (одобрение, отклонение или возврат) инициированных запросов на утверждение. Узел "Утверждение" может использоваться только в процессах утверждения.

:::info{title=Подсказка}
Отличие от обычного узла "Ручная обработка": обычный узел "Ручная обработка" охватывает более широкий спектр сценариев и может использоваться для ручного ввода данных или принятия решений о продолжении рабочего процесса в различных типах рабочих процессов. Узел "Утверждение" — это специализированный узел, предназначенный исключительно для процессов утверждения, и его нельзя использовать в других рабочих процессах.
:::

## Создание узла

Нажмите кнопку плюс ("+") в процессе, чтобы добавить узел "Утверждение", затем выберите один из режимов одобрения для создания узла утверждения:

![Создание узла утверждения](https://static-docs.nocobase.com/f15d61208a3918d005cd2031fc9b6ce7.png)

## Режимы одобрения

Существует два режима одобрения:

1. Прямой режим: Обычно используется для более простых процессов. Прохождение или непрохождение узла утверждения определяет, завершается ли процесс. В случае отказа процесс завершается немедленно.

    ![Прямой режим утверждения](https://static-docs.nocobase.com/a9d446a186f61c546607cf1c2534b287.png)

2. Режим ветвления: Обычно используется для более сложных логических процессов. После получения любого результата утверждения можно продолжить выполнение других узлов в соответствующей ветке результатов.

    ![Режим ветвления утверждения](https://static-docs.nocobase.com/57dc6a8907f3bb02fb28c354c241e4e5.png)

    Если узел настроен на выполнение действия "Возврат", появляется ветка "Возврат", и после её выполнения текущий процесс принудительно завершается.

    Если узел "принят", то помимо выполнения ветки "принято", также продолжится выполнение последующего процесса. После действия "отклонено" по умолчанию также продолжится выполнение последующего процесса, но можно настроить завершение процесса сразу после выполнения ветки.

:::info{title=Подсказка}
Режим одобрения нельзя изменить после создания узла.
:::

## Утверждающие лица

Утверждающие лица — это группа пользователей, ответственных за выполнение операций утверждения в данном узле. Это может быть один или несколько пользователей. Источник выбора может быть статическим значением из списка пользователей или динамическим значением, указанным через переменные.

![Утверждающие лица](https://static-docs.nocobase.com/29c64297d577b9ca9457b1d7ac62287d.png)

При выборе переменной можно выбрать только первичный или внешний ключ данных пользователей из контекста или результатов узла. Если выбранная переменная является массивом (отношение "один-ко-многим") во время выполнения, то каждый пользователь из этого массива будет добавлен в общее множество утверждающих лиц.

## Режим согласования

Если в результате окончательного выполнения остается только один утверждающий (включая случаи, когда дубликаты устраняются среди нескольких переменных), то независимо от выбранного режима согласования, операцию утверждения выполняет только этот пользователь, и результат определяется только им.

Когда в множестве утверждающих лиц есть несколько пользователей, выбор разных режимов согласования означает разные способы обработки:

1. "ИЛИ"-подпись: Достаточно одобрения одного из участников, чтобы узел считался пройденным. Отклонение узла происходит, только если все участники отклоняют.
2. "И"-подпись: Необходимо, чтобы все участники одобрили узел для его успешного прохождения. Отклонение хотя бы одним участником приводит к отказу узла.
3. Голосование: Требуется, чтобы более установленной доли участников проголосовали за одобрение, чтобы узел был пройден; если голосов за одобрение недостаточно, узел считается отклоненным.

Что касается действия "Возврат", то в любом режиме, если любой из утверждающих лиц выполняет действие "Возврат", узел немедленно прекращает процесс.

## Порядок обработки

Также, когда в множестве утверждающих лиц есть несколько пользователей, выбор разных порядков обработки означает разные способы выполнения:

1. **Параллельно**: Все утверждающие лица могут выполнять действия в произвольном порядке, последовательность обработки не имеет значения.
2. **Последовательно**: Утверждающие лица выполняют действия строго в порядке, указанном в множестве утверждающих лиц. Следующий утверждающий может приступить к обработке только после того, как предыдущий завершит свою задачу.

Независимо от того, установлен ли режим "последовательной" обработки или нет, результат, основанный на фактической последовательности действий, следует правилам "режима согласования", описанным выше. Как только достигаются соответствующие условия, выполнение узла завершается.

## Выход из рабочего процесса после завершения ветки отказа

Когда для "режима прохождения" установлен "режим ветвления", можно выбрать выход из рабочего процесса после завершения ветки отказа. После выбора этого параметра в конце ветки отказа появится значок "✗", указывающий, что процесс больше не продолжится:

![Выход после отказа](https://static-docs.nocobase.com/1e740df93c128fb6fe54bf85a740e683.png)

## Настройка интерфейса утверждающего лица

Настройка интерфейса утверждающего лица используется для предоставления интерфейса операций при выполнении рабочего процесса утверждения до данного узла. Нажмите кнопку настройки, чтобы открыть всплывающее окно:

![Всплывающее окно настройки интерфейса утверждающего лица](https://static-docs.nocobase.com/2c321ae164b436f1c572305ff27cc9dd.png)

Во всплывающем окне настройки можно добавить блоки с информацией о деталях утверждения, панель действий и настраиваемый текст подсказки:

![Добавление блоков в интерфейс утверждающего лица](https://static-docs.nocobase.com/9f8f11926e935ad8f8fbeec368edebfe.png)

Блок с деталями утверждения содержит данные, отправленные инициатором, и аналогичен обычному блоку данных. В него можно свободно добавлять компоненты полей таблицы данных и изменять их расположение для организации информации, которую должны просматривать утверждающие лица:

![Блок с деталями утверждения](https://static-docs.nocobase.com/1140ec13caeea1b364d12e057720a29c.png)

На панели действий можно добавить кнопки поддерживаемых операций для данного узла, например, "Одобрить", "Отклонить" и "Вернуть":

![Панель действий в интерфейсе утверждающего лица](https://static-docs.nocobase.com/1bb090ed123f62ba8a524a3e9e7da328.png)

Кроме того, на панели действий можно добавить связанные поля, требующие заполнения утверждающим лицом, например, поле "Комментарий".

:::warning{title=Важно}
Если вы включили или отключили кнопку операции, необходимо сохранить конфигурацию узла после закрытия всплывающего окна настройки интерфейса. В противном случае изменения кнопки не вступят в силу.
:::