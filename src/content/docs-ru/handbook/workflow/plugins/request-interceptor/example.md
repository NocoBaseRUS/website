# Пример

Соединяя основные инструкции выше, мы рассмотрим сценарий "Подтверждение заказа". Предположим, что нам нужно проверить наличие на складе всех продуктов, выбранных пользователем при подтверждении заказа. Если хотя бы у одного выбранного продукта недостаточно запасов, отправка заказа будет заблокирована, и соответствующее сообщение будет возвращено; циклическая проверка каждого продукта будет продолжаться до тех пор, пока все запасы не будут достаточными, затем заказ будет одобрен и созданы данные заказа для пользователя.

Остальные шаги аналогичны описанию в инструкциях. Однако, поскольку один заказ включает несколько товаров, помимо добавления отношений "многие ко многим" между «заказом» <-- m:1 -- «детали заказа» -- 1:m --> «продуктами» при моделировании данных, необходимо также добавить узел "цикл" в рабочем процессе события перед операцией, чтобы циклически проверять, достаточно ли запасов каждого продукта:

![Пример_процесс циклической проверки](https://static-docs.nocobase.com/8307de47d5629595ab6cf00f8aa898e3.png)

Объект цикла выбирается из массива «деталей заказа» в отправленных данных заказа:

![Пример_конфигурация объекта цикла](https://static-docs.nocobase.com/ed662b54cc1f5425e2b472053f89baba.png)

Условный узел в циклическом процессе используется для определения, достаточно ли запасов текущего циклического объекта товара:

![Пример_условное суждение в цикле](https://static-docs.nocobase.com/4af91112934b0a04a4ce55e657c0833b.png)

Другие конфигурации совпадают с базовыми настройками использования. В итоге, при отправке заказа, если хотя бы у одного товара недостаточно запасов, отправка заказа будет заблокирована, и соответствующее сообщение будет возвращено. При тестировании попробуйте отправить несколько товаров в одном заказе, где у одного товара недостаточно запасов, а у другого достаточно, можно увидеть возвращаемое сообщение:

![Пример_сообщение после отправки](https://static-docs.nocobase.com/dd9e81084aa237bda0241d399ac19270.png)

Можно видеть, что в ответном сообщении нет предупреждения о недостатке запасов первого продукта "iPhone 15 pro", а только предупреждение о недостатке запасов второго продукта "iPhone 14 pro". Это связано с тем, что в цикле у первого продукта запасы были достаточными, поэтому он не был заблокирован, тогда как у второго продукта запасы были недостаточными, поэтому отправка заказа была заблокирована.