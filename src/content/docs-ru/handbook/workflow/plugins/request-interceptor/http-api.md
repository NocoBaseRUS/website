# Внешний вызов

Событие перед операцией само интегрируется на этапе обработки запроса, поэтому его также можно вызывать через HTTP API.

Для рабочих процессов, локально связанных с кнопкой операции, вызов может быть выполнен следующим образом (в качестве примера используется кнопка создания в таблице `posts`):

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post."
  }'
  "http://localhost:3000/api/posts:create?triggerWorkflows=workflowKey"
```

В параметре URL `triggerWorkflows` указывается ключ (key) рабочего процесса, при этом несколько рабочих процессов разделяются запятыми. Этот ключ можно получить, наведя курсор на название рабочего процесса в верхней части холста рабочего процесса:

![Способ_просмотра_key_рабочего_процесса](https://static-docs.nocobase.com/20240426135108.png)

После отправки вышеуказанного вызова будет инициировано событие перед операцией для таблицы `posts`. После завершения обработки соответствующего рабочего процесса данные будут успешно созданы и возвращены.

Если настроенная рабочая процедура доходит до "узла завершения", логика работы аналогична действию интерфейса — запрос будет перехвачен, и данные не будут созданы. Если статус в узле завершения настроен как неудачный, код состояния ответа будет `400`, а в случае успеха — `200`.

Если перед завершающим узлом также настроен узел "Сообщение отклика", сгенерированное сообщение также будет возвращено в результатах ответа. Структура ответа в случае ошибки выглядит следующим образом:

```json
{
  "errors": [
    {
      "message": "message from 'Response message' node"
    }
  ]
}
```

Когда "узел завершения" настроен как успешный, структура сообщения выглядит следующим образом:

```json
{
  "messages": [
    {
      "message": "message from 'Response message' node"
    }
  ]
}
```

:::info{title=Подсказка}
Поскольку узлов "Сообщение отклика" может быть добавлено несколько в процессе, структура данных возвращаемых сообщений будет массивом.
:::

Если событие перед операцией настроено в глобальном режиме, то при вызове HTTP API не нужно использовать параметр URL `triggerWorkflows` для указания соответствующего рабочего процесса. Достаточно вызвать операцию соответствующей таблицы данных, чтобы инициировать событие.

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post."
  }'
  "http://localhost:3000/api/posts:create"
```

:::info{title="Примечание"}
При вызове события после операции через HTTP API также следует учитывать состояние активации рабочего процесса и соответствует ли конфигурация таблицы данных требованиям. В противном случае вызов может завершиться неудачей или возникнуть ошибка.
:::
