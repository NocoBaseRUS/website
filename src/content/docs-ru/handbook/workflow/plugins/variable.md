# Пользовательские переменные

<PluginInfo name="workflow-variable" link="/handbook/workflow/plugins/variable" commercial="true"></PluginInfo>

В процессе можно объявить переменные или присвоить значения уже объявленным переменным. Обычно это используется для хранения временных данных в процессе.

<embed src="../../../_partials/commercial-installation.md"></embed>

## Руководство по использованию

### Создание узла

В интерфейсе конфигурации рабочего процесса нажмите кнопку плюс ("+") в процессе, чтобы добавить узел "Переменная":

![Добавление узла переменной](https://static-docs.nocobase.com/53b1e48e777bfff7f2a08271526ef3ee.png)

### Настройка узла

#### Режим

Узел переменной аналогичен переменным в программировании: сначала нужно объявить переменную, а затем её можно использовать и присваивать ей значения. Поэтому при создании узла переменной необходимо выбрать режим переменной. Есть два доступных режима:

![Выбор режима](https://static-docs.nocobase.com/49d8b7b501de6faef6f303262aa14550.png)

- **Объявление новой переменной**: Создание новой переменной.
- **Присвоение значения существующей переменной**: Присвоение значения переменной, объявленной ранее в процессе (эквивалентно изменению значения переменной).

Если создаваемый узел является первым узлом переменной в процессе, доступен только режим объявления, так как на данный момент еще нет переменных, которым можно было бы присвоить значение.

При выборе присвоения значения существующей переменной также необходимо выбрать целевую переменную, то есть узел, в котором была объявлена переменная:

![Выбор переменной для присвоения значения](https://static-docs.nocobase.com/1ce8911548d7347e693d8cc8ac1953eb.png)

#### Значение

Значением переменной может быть любой тип данных: константа (например, строка, число, логическое значение или дата) или другие переменные из процесса.

В режиме объявления установка значения переменной эквивалентна присвоению начального значения.

![Установка начального значения](https://static-docs.nocobase.com/4ce2c508986565ad537343013758c6a4.png)

В режиме присваивания установка значения эквивалентна изменению значения уже объявленной целевой переменной. В дальнейшем при использовании переменной будет возвращаться это новое значение.

![Присвоение значения объявленной переменной значению триггера](https://static-docs.nocobase.com/858bae180712ad279ae6a964a77a7659.png)

### Использование значения переменной

В последующих узлах после узла переменной можно использовать значение объявленной переменной, выбрав её из группы "Переменные узла". Например, в узле запроса можно использовать значение переменной в качестве условия фильтрации:

![Использование значения переменной в качестве условия фильтрации запроса](https://static-docs.nocobase.com/1ca91c295254ff85999a1751499f14bc.png)

### Пример

Узел переменной особенно полезен в сценариях, где требуется выполнить вычисления или объединение новых значений с предыдущими (аналогично `reduce`/`concat` в программировании) в некоторых ветках процесса, а затем использовать результат после завершения этих веток. В следующем примере мы используем узлы цикла и переменной для создания строки получателей.

Сначала создайте рабочий процесс, активируемый событием таблицы данных, который запускается при обновлении данных в таблице "Статьи", и предварительно загрузите связанные данные "Авторы" (для получения получателей):

![Настройка триггера](https://static-docs.nocobase.com/93327530a93c695c637d74cdfdcd5cde.png)

Затем создайте узел переменной для хранения строки получателей:

![Узел переменной получателя](https://static-docs.nocobase.com/d26fa4a7e7ee4f34e0d8392a51c6666e.png)

Далее создайте узел циклической ветки, чтобы перебрать авторов статьи и добавить их адреса в строку получателей:

![Цикл по авторам статьи](https://static-docs.nocobase.com/083fe62c943c17a643dc47ec2872e07c.png)

Внутри циклической ветки сначала создайте узел вычисления, чтобы объединить текущего автора со строкой уже сохранённых адресов:

![Объединение строки адресов получателей](https://static-docs.nocobase.com/5d21a990162f32cb8818d27b16fd1bcd.png)

После узла вычисления создайте узел переменной, выбрав режим присваивания. Целевой узел для присваивания — это узел переменной получателя, а значение берётся из результата вычислительного узла:

![Присвоение объединённой строки адресов получателя узлу получателя](https://static-docs.nocobase.com/fc40ed95dd9b61d924b7ca11b23f9482.png)

Таким образом, после завершения циклической ветки в переменной получателя будет сохранена строка адресов всех авторов статьи. После этого можно использовать узел HTTP-запроса для вызова API отправки письма, передавая значение переменной получателя как параметр получателя:

![Отправка письма через узел запроса](https://static-docs.nocobase.com/37f71aa1a63e172bcb2dce10a250947e.png)

На этом простая функция массовой рассылки писем реализована с использованием узлов цикла и переменной.