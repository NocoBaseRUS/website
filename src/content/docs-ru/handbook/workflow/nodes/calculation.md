# Вычисление

Узел вычисления, хотя и не управляет потоком, является важной функцией в потоке. Узел вычисления позволяет вычислять выражение, результат которого сохраняется в результатах соответствующего узла для использования другими узлами. Это инструмент для вычисления, обработки и преобразования данных, который в определенной степени может заменить вызов функций для вычисления значения и присвоение его переменной в языках программирования.

## Создание узла

В интерфейсе конфигурации рабочего процесса нажмите кнопку «+» в потоке, чтобы добавить узел «Вычисление»:

![Добавление узла вычисления](https://static-docs.nocobase.com/58a455540d26945251cd143eb4b16579.png)

## Настройка узла

![Настройка узла вычисления](https://static-docs.nocobase.com/6a155de3f6a883d8cd1881b2d9c33874.png)

### Вычислительный движок

Движок вычислений определяет синтаксис, поддерживаемый выражениями. В настоящее время поддерживаются два движка вычислений: [Math.js](https://mathjs.org/) и [Formula.js](https://formulajs.info/). Каждый движок включает множество часто используемых функций и методов для работы с данными. Подробное описание можно найти в официальной документации.

:::info{title=Подсказка}
Обратите внимание, что доступ к элементам массива различается для разных движков: в Math.js индексация начинается с `1`, а в Formula.js — с `0`.
:::

### Сцепка строк

Если требуется простая сцепка строк, можно использовать «строковый шаблон». Этот движок заменит переменные в выражении их соответствующими значениями и вернет сцепленную строку.

### Выражение

Выражение представляет собой строковое представление операционной формулы, которое может включать переменные, константы, операторы и поддерживаемые функции. Можно использовать переменные контекста потока, такие как результаты предыдущих узлов, или локальные переменные в циклах.

Если ввод выражения не соответствует синтаксису, в интерфейсе настройки узла будет показана ошибка. Если при выполнении выражения переменная не существует, типы не совпадают или используется несуществующая функция, узел вычисления завершится с ошибкой.

## Примеры

### Вычисление общей суммы заказа

В одном заказе может быть несколько товаров, каждый из которых имеет разные цены и количества. Общая сумма заказа должна быть рассчитана как сумма произведений цены и количества для каждого товара. Это можно сделать после загрузки списка деталей заказа (для множественных отношений) с помощью узла вычисления:

![Пример настройки узла вычисления](https://static-docs.nocobase.com/85966b0116afb49aa966eeaa85e78dae.png)

Функция `SUMPRODUCT` в Formula.js может вычислить сумму произведений двух массивов одинаковой длины построчно, что позволяет получить общую сумму заказа.