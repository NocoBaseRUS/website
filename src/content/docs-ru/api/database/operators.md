# Операторы фильтрации

Используются в параметре filter API-методов `find`, `findOne`, `findAndCount`, `count` и других для Repository:

```ts
const repository = db.getRepository('books');

repository.find({
  filter: {
    title: {
      $eq: '春秋',
    },
  },
});
```

Для поддержки JSON-формата в NocoBase операторы запроса обозначаются строками с префиксом `$`.

Кроме того, NocoBase предоставляет API для расширения операторов. Подробнее см. в разделе [`db.registerOperators()`](../database#registeroperators).

## Общие операторы

### `$eq`

Проверяет, равно ли значение поля указанному значению. Эквивалентно оператору `=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $eq: 'Весна и Осень',
    },
  },
});
```

Эквивалентно `title: 'Весна и Осень'`.

### `$ne`

Проверяет, не равно ли значение поля указанному значению. Эквивалентно оператору `!=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $ne: 'Весна и Осень',
    },
  },
});
```

### `$is`

Проверяет, является ли значение поля указанным значением. Эквивалентно оператору `IS` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $is: null,
    },
  },
});
```

### `$not`

Проверяет, не является ли значение поля указанным значением. Эквивалентно оператору `IS NOT` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $not: null,
    },
  },
});
```

### `$col`

Проверяет, равно ли значение поля значению другого поля. Эквивалентно оператору `=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $col: 'name',
    },
  },
});
```

### `$in`

Проверяет, находится ли значение поля в указанном массиве. Эквивалентно оператору `IN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $in: ['Весна и Осень', 'Период воюющих государств'],
    },
  },
});
```

### `$notIn`

Проверяет, не находится ли значение поля в указанном массиве. Эквивалентно оператору `NOT IN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIn: ['Весна и Осень', 'Период поющих птич'],
    },
  },
});
```

### `$empty`

Проверяет, является ли значение обычного поля пустым. Если это строковое поле — проверяет, является ли оно пустой строкой; если это массивное поле — проверяет, является ли оно пустым массивом.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $empty: true,
    },
  },
});
```

### `$notEmpty`

Проверяет, является ли значение обычного поля непустым. Если это строковое поле — проверяет, не является ли оно пустой строкой; если это массивное поле — проверяет, не является ли оно пустым массивом.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notEmpty: true,
    },
  },
});
```

## Логические операторы

### `$and`

Логический AND. Эквивалентен оператору `AND` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    $and: [{ title: 'Книга песен' }, { isbn: '1234567890' }],
  },
});
```

### `$or`

Логический OR. Эквивалентен оператору `OR` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    $or: [{ title: 'Книга песен' }, { publishedAt: { $lt: '0000-00-00T00:00:00Z' } }],
  },
});
```

## Операторы для полей логического типа

Используются для полей логического типа `type: 'boolean'`.

### `$isFalsy`

Проверяет, является ли значение логического поля ложным. Значения логического поля, такие как `false`, `0` и `NULL`, будут считаться `$isFalsy: true`.

**Пример**

```ts
repository.find({
  filter: {
    isPublished: {
      $isFalsy: true,
    },
  },
});
```

### `$isTruly`

Проверяет, является ли значение логического поля истинным. Значения логического поля, такие как `true` и `1`, будут считаться `$isTruly: true`.

**Пример**

```ts
repository.find({
  filter: {
    isPublished: {
      $isTruly: true,
    },
  },
});
```

## Операторы для числовых типов полей

Используются для числовых типов полей, включая:

- `type: 'integer'` (целое число)
- `type: 'float'` (число с плавающей точкой)
- `type: 'double'` (число двойной точности)
- `type: 'real'` (вещественное число)
- `type: 'decimal'` (десятичное число)

### `$gt`

Проверяет, является ли значение поля больше указанного значения. Эквивалентно оператору `>` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $gt: 100,
    },
  },
});
```

### `$gte`

Проверяет, является ли значение поля больше или равно указанному значению. Эквивалентно оператору `>=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $gte: 100,
    },
  },
});
```

### `$lt`

Проверяет, является ли значение поля меньше указанного значения. Эквивалентно оператору `<` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $lt: 100,
    },
  },
});
```

### `$lte`

Проверяет, является ли значение поля меньше или равно указанному значению. Эквивалентно оператору `<=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $lte: 100,
    },
  },
});
```

### `$between`

Проверяет, находится ли значение поля между двумя указанными значениями. Эквивалентно оператору `BETWEEN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $between: [100, 200],
    },
  },
});
```

### `$notBetween`

Проверяет, не находится ли значение поля между двумя указанными значениями. Эквивалентно оператору `NOT BETWEEN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $notBetween: [100, 200],
    },
  },
});
```

## Операторы для строковых типов полей

Используются для полей строкового типа, включая `string`.

### `$includes`

Проверяет, содержит ли строковое поле указанную подстроку.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $includes: '三字经',
    },
  },
});
```

### `$notIncludes`

Проверяет, не содержит ли строковое поле указанную подстроку.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIncludes: '三字经',
    },
  },
});
```

### `$startsWith`

Проверяет, начинается ли строковое поле с указанной подстроки.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $startsWith: '三字经',
    },
  },
});
```

### `$notStatsWith`

Проверяет, не начинается ли строковое поле с указанной подстроки.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notStatsWith: '三字经',
    },
  },
});
```

### `$endsWith`

Проверяет, заканчивается ли строковое поле указанной подстрокой.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $endsWith: 'Три Слова',
    },
  },
});
```

### `$notEndsWith`

Проверяет, не заканчивается ли строковое поле указанной подстрокой.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notEndsWith: 'Трехсимвольная классика',
    },
  },
});
```

### `$like`

Проверяет, содержит ли значение поля указанную строку. Эквивалентно оператору `LIKE` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $like: 'Компьютер',
    },
  },
});
```

### `$notLike`

Проверяет, не содержит ли значение поля указанную строку. Эквивалентно оператору `NOT LIKE` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notLike: 'Компьютер',
    },
  },
});
```

### `$iLike`

Проверяет, содержит ли значение поля указанную строку, игнорируя регистр. Эквивалентно оператору `ILIKE` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notILike: 'Комрьютер',
    },
  },
});
``` 

### `$notILike`

Проверяет, не содержит ли значение поля указанную строку, игнорируя регистр. Эквивалентно оператору `NOT ILIKE` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notILike: 'Комрьютер',
    },
  },
});
```

### `$regexp`

Проверяет, соответствует ли значение поля указанному регулярному выражению. Эквивалентно оператору `REGEXP` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $regexp: '^Компьютер',
    },
  },
});
```

### `$notRegexp`

Проверяет, не соответствует ли значение поля указанному регулярному выражению. Эквивалентно оператору `NOT REGEXP` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notRegexp: '^Компьютер',
    },
  },
});
```

### `$iRegexp`

Проверяет, соответствует ли значение поля указанному регулярному выражению, игнорируя регистр. Эквивалентно оператору `~*` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $iRegexp: '^COMPUTER',
    },
  },
});
```

### `$notIRegexp`

Проверяет, не соответствует ли значение поля указанному регулярному выражению, игнорируя регистр. Эквивалентно оператору `!~*` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIRegexp: '^COMPUTER',
    },
  },
});
```

## Операторы для полей типа "дата"

Используются для полей даты `type: 'date'`.

### `$dateOn`

Проверяет, находится ли значение поля даты в пределах указанного дня.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateOn: '2021-01-01',
    },
  },
});
```

### `$dateNotOn`

Проверяет, не находится ли значение поля даты в пределах указанного дня.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotOn: '2021-01-01',
    },
  },
});
```

### `$dateBefore`

Проверяет, находится ли значение поля даты до указанного значения. Эквивалентно операции "меньше" для переданного значения даты.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateBefore: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

### `$dateNotBefore`

Проверяет, не находится ли значение поля даты до указанного значения. Эквивалентно операции "больше или равно" для переданного значения даты.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotBefore: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

### `$dateAfter`

Проверяет, находится ли значение поля даты после указанного значения. Эквивалентно операции "больше" для переданного значения даты.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateAfter: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

### `$dateNotAfter`

Проверяет, не находится ли значение поля даты после указанного значения. Эквивалентно операции "меньше или равно" для переданного значения даты.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotAfter: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

## Операторы для полей типа "массив"

Используются для полей массива `type: 'array'`.

### `$match`

Проверяет, соответствует ли значение поля массива значениям из указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $match: ['литература', 'история'],
    },
  },
});
```

### `$notMatch`

Проверяет, не соответствует ли значение поля массива значениям из указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $notMatch: ['литература', 'история'],
    },
  },
});
```

### `$anyOf`

Проверяет, содержит ли значение поля массива любое из значений указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $anyOf: ['литература', 'история'],
    },
  },
});
```

### `$noneOf`

Проверяет, не содержит ли значение поля массива ни одного из значений указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $noneOf: ['литература', 'история'],
    },
  },
});
```

### `$arrayEmpty`

Проверяет, является ли массив в поле пустым.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $arrayEmpty: true,
    },
  },
});
```

### `$arrayNotEmpty`

Проверяет, не является ли массив в поле пустым.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $arrayNotEmpty: true,
    },
  },
});
```

## Операторы для типов полей отношений

Используются для проверки существования отношений. Типы полей включают:

- `type: 'hasOne'`
- `type: 'hasMany'`
- `type: 'belongsTo'`
- `type: 'belongsToMany'`

### `$exists`

Существует связанная запись.

**Пример**

```ts
repository.find({
  filter: {
    author: {
      $exists: true,
    },
  },
});
```

### `$notExists`

Отсутствует связанная запись.

**Пример**

```ts
repository.find({
  filter: {
    author: {
      $notExists: true,
    },
  },
});
```
